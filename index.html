<!DOCTYPE html>
<html>
<head>
  <title></title>
   <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
   <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   <style type="text/css">
     #mapid { width: 1024px; height: 1024px; }
   </style>
</head>
<body>
  <div id="mapid"></div>
  <script type="text/javascript">
    var gnctd_covid_facilities_data;
    $.getJSON('https://coronabeds.jantasamvad.org/covid-facilities.js?callback=?', function(data) {
        gnctd_covid_facilities_data = data;
    });
    
    var gnctd_covid_data;
    $.getJSON('https://coronabeds.jantasamvad.org/covid-info.js?callback=?', function(data) {
        gnctd_covid_data = data;
    });
    
    setTimeout(function(){
        var mymap = L.map("mapid").setView([28.6469655, 77.0932634], 11);

        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoicHh0aHhrIiwiYSI6ImNrbnN0cHE2bTA3cGoycXBkajNuMnV5bTQifQ.si6acX_-tJGxBIiQWrHHCQ', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoicHh0aHhrIiwiYSI6ImNrbnN0cHE2bTA3cGoycXBkajNuMnV5bTQifQ.si6acX_-tJGxBIiQWrHHCQ'
        }).addTo(mymap);

        for(var i in gnctd_covid_facilities_data) {
          try {
            if(gnctd_covid_facilities_data[i]["location"]) {
              if(gnctd_covid_facilities_data[i]["location"].split("/")[6].split(",").length == 3) {
                var coord = gnctd_covid_facilities_data[i]["location"].split("/")[6].replace("@", "").split(",");
              } else {
                var coord = gnctd_covid_facilities_data[i]["location"].split("/")[7].replace("@", "").split(",");
              }

              var hspInfo = "<b>" + i + "</b><br>";
              var contact_numbers = "Contact: " + gnctd_covid_facilities_data[i]["contact_numbers"].join(", ") + "<br>";
              var loc = "<a href=" + gnctd_covid_facilities_data[i]["location"] + " target='_blank'>Click for Location</a><br>";
              var bedInfo = ""

              for(var j in gnctd_covid_data) {
                if(gnctd_covid_data[j][i]){
                  var type = gnctd_covid_data[j][i]["type"] + "<br>";
                  var last_updated_at = "Last Updated: " + gnctd_covid_data[j][i]["last_updated_at"] + "<br>";

                  bedInfo = bedInfo + "<br><b>" + j.split("_").join(" ").replace(/(^|\s)\S/g, l => l).toUpperCase() + "</b><br>Total: " + gnctd_covid_data[j][i]["total"] + "<br>Vacant: " + gnctd_covid_data[j][i]["vacant"] + "<br>";
                }
              }
                
              var marker = L.marker([coord[0], coord[1]]).addTo(mymap).bindPopup(hspInfo + type + contact_numbers + loc + last_updated_at + bedInfo).openPopup();
            } else {
              console.log("No location");
            }
          } catch(err) {
            console.log(err);
          }
        }
    }, 2000);
  </script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YHLL5RH0L7"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-YHLL5RH0L7');
  </script>
</body>
</html>
